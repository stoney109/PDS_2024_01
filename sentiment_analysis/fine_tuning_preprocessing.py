import pandas as pd

# 긍정 단어와 부정 단어에 가중치 부여
word_weights = {
    "좋음": 2,
    "사회성": 2,
    "사랑스러움": 3,
    "친화적": 2,
    "활기찬": 2,
    "목욕": 1,
    "건강": 2,
    "귀여움": 4,
    "불리불안": -3,
    "털빠짐": -3,
    "질투": -1,
    "예민": -2,
    "사람을 좋아함": 3,
    "신경질적": -2,
    "패드 훈련 중": 1,
    "털빠짐 있음": -2,
    "흥분 주의": -2,
    "어린 자녀 적합": 2,
    "건강한": 2,
    "조용한": 1,
    "질투심": -1,
    "애교": 3,
    "큰 눈": 2,
    "꼬리털": 1,
    "귀여운": 3,
    "호기심 많음": 2,
    "활동적": 2,
    "요구성 짖음": -2,
    "대소변 잘 가림": 3,
    "고름": -3,
    "호흡기": -2,
    "귓병": -2,
    "당뇨병": -3,
    "예쁨": 3,
    "응석": -1,
    "입질": -3,
    "꼬장기": -2,
    "살찌우기": 1,
    "중성화": 1,
    "혼자": -1,
    "호스피스": -3,
    "외향적": 2,
    "명랑": 2,
    "책임감": 2,
    "소심": -2,
    "심장사상충 감염": -3,
    "긴장": -1,
    "패드배변 훈련 중": 1,
    "순함": 2,
    "가정 적합": 2,
    "중재적": 1,
    "야무지": 2,
    "매력적": 3,
    "발랄": 2,
    "고독": -2,
    "산책": 3,
    "새로운 가족과 쉽게 친해짐": 3,
    "납작한 코": 1,
    "안과질병": -2,
    "먹는 것을 좋아함": 2,
    "백치미": 1,
    "독립적": 1,
    "영유아 적합": 2,
    "장난감 좋아함": 2,
    "폭신한 방석 좋아함": 2,
    "애교부림": 3,
    "낙천적": 3,
    "똑똑함": 3,
    "사교적": 2,
    "긴 털": 1,
    "매력적인 코트": 2,
    "안기 좋아함": 3,
    "하울링": -2,
    "공격성 없음": 3,
    "총총 뛰기": 2,
    "적응력 좋음": 3,
    "의지적": 2,
    "훈련 필요": -1,
    "근사함": 3,
    "엄청 좋아함": 3,
    "작은 체구": 1,
    "각막궤양": -2,
    "피부병": -2,
    "미소천사": 3,
    "식욕부진": -2,
    "편식": -1,
    "마른": -1,
    "에너지": 2,
    "간식": 2,
    "폭신한": 2,
    "효자": 2,
    "짧은 다리": 1,
    "다른 강아지를 싫어함": -2,
    "마음의 상처": -2,
    "사랑 필요": 3,
    "주인바라기": 2,
    "허리 민감": -1,
    "사료 애호": 2,
    "목욕 잘함": 2,
    "체중감량": 1,
    "슬관절 건강": 2,
    "꾸준한 관리": 1,
    "우렁찬 성량": -1,
    "눈 큼": 2,
    "활발하지 않음": -1,
    "순한": 2,
    "털 관리 필요": -1,
    "활발함": 3,
    "장난감을 크게 좋아하지 않음": -1,
    "활동량 적음": -1,
    "두 눈": 1,
    "발톱": 0,
    "장애": -2,
    "냄새": -1,
    "묵묵함": 1,
    "불편": -2,
    "경계심": -1,
    "인내": 1,
    "믿음": 3,
    "특별": 2,
    "배변훈련 필요": -1,
    "식욕 왕성": 2,
    "간식 애호": 2,
    "야외 활동 좋아함": 3,
    "점프 좋아함": 2,
    "편식 없음": 2,
    "배변 깔끔": 3,
    "혼자있음": -1,
    "스킨십": 2,
    "인내심": 2,
    "쫄보": -2,
    "마우스펀칭": -2,
    "다리 다쳤던": -2,
    "털빠짐 많음": -3,
    "영양결핍": -3,
    "안구궤양": -3,
    "탈장": -2,
    "중이염": -2,
    "호흡기질환": -3,
    "신장질환": -3,
    "무릎견": 1,
    "상처치유": 2,
    "극소심": -3,
    "겁많음": -2,
    "호전적": -2,
    "용기": 2,
    "고급지": 2,
    "근사": 2,
    "주위를 맴돔": -1,
    "견제": -1,
    "외부 활동": 2,
    "거친 스킨십에 겁": -2,
    "지시어 훈련X": -1,
    "멋진": 3,
}

def analyze_sentiment(text, word_weights):
    words = text.split()  # 텍스트를 공백 기준으로 분리
    score = sum(word_weights.get(word, 0) for word in words)  # 단어 가중치 합산

    # 결과 판단
    if score > 0:
        return "긍정", score
    elif score < 0:
        return "부정", score
    else:
        return "중립", score

# CSV 파일에서 데이터 읽기 및 감성 분석 수행
def process_csv(input_csv, output_csv, column_name, encoding="utf-8-sig"):
    try:
        # CSV 파일 읽기
        df = pd.read_csv(input_csv, encoding=encoding)

        # 텍스트 열에서 감성 분석 수행
        if column_name in df.columns:
            # 감성 분석 수행하여 두 개의 새로운 열 추가
            df['Sentiment'], df['Score'] = zip(*df[column_name].apply(lambda text: analyze_sentiment(text, word_weights)))

            sentiment_to_label = {"긍정": 1, "부정": 0, "중립": 2}
            df["Label"] = df["Sentiment"].map(sentiment_to_label)
            
            # 결과를 새로운 CSV 파일로 저장
            df.to_csv(output_csv, index=False, encoding=encoding)
            print(f"결과가 저장되었습니다: {output_csv}")
        else:
            print(f"열 '{column_name}'이(가) CSV 파일에 없습니다.")

    except FileNotFoundError:
        print(f"파일을 찾을 수 없습니다: {input_csv}")
    except Exception as e:
        print(f"오류 발생: {e}")

# 실행
if __name__ == "__main__":
    # 사용자 지정 경로
    input_csv_path = "../resource/trait_seoul_with_gpt.csv"  # 입력 CSV 파일 경로 (수정 필요)
    output_csv_path = "../resource/output_with_sentiment.csv"  # 출력 CSV 파일 경로
    text_column = "GPT_특성"  # 분석할 텍스트 열 이름

    # 감성 분석 및 CSV 처리 실행
    process_csv(input_csv_path, output_csv_path, text_column)